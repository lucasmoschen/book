\chapter{Relações}
Em capítulos anteriores, discutimos proposições que lidavam com a relação entre objetos matemáticos. Muitas vezes na matemática, e mesmo no contexto em que estamos inseridos, estamos interessados em definir e estudar relações entre objetos distintos. Por exemplo, podemos estar interessados em certas própriedades sobre a relação \textit{é vais velho que}, entre seres vivos, e diremos que essa é uma relação \textit{irreflexiva}, \textit{transitiva}, ou ainda, uma relação de \textit{ordem estrita}.

Nesse capítulo discutimos exatamente essas noções, e definimos certos tipos de relaçõs mais comuns.

\section{Conceito de Relações}

Dados dois conjuntos $A$ e $B$, uma relação de $A$ em $B$ é qualquer subconjunto de $A\times B$ (Produto  cartesiano).\\

\textit{Exemplo:} $A = \{1,2,3\} $ e $ B = \{4,5,6\}$

$R_{1} = \{(1,4),(2,5)\}$

$R_{2} = \{(1,4),(1,5),(2,4),(3,5)\}$\\

Para efeito de nomenclatura, considere, por exemplo, que o elemento $a \in A$ está relacionado a $b \in B$ por uma relação $R$, Podemos denotar $aRb$, ou $R(a,b)$ significando que o par $(a,b)\in R$, está definido como existente no universo daquela relação. Como se pode esperar, a relação pode ter qualquer aridade necessária, e relacionar objetos de tipos distintos.

O domínio de uma relação $R$ de $A$ em $B$ é o conjunto formado pelos elementos de $A$ que se relacionam com alguém de $B$, no caso da relação $R_{1}$, por exemplo, $Dom(R_{1}) = \{1,2\}$.

O contradomínio de uma relação $R$ de $A$ em $B$ é o conjunto de elementos de $B$ que podem se relacionar com elementos de $A$, ou seja, é o própio $B$, $Cd(R_{1}) = Cd(R_{2}) =  \{4,5,6\}$.

A imagem de uma relação $R$ de $A$ em $B$ é o conjunto de elementos de $B$ que são relacionados por alguém de $A$, no caso da relação $R_{2}$, por exemplo, $Im(R_{2}) = \{4,5\}$.

Considere, a partir disso, o universo de objetos $u = \{Ana, Bia, Cid\}$, e a relação \textit{conhece}, definida por $U\times U \supseteq A = \{(Ana, Bia), (Bia, Cid)\}$. Podemos dizer que \textit{Bia conhece Ana}?

Definimos uma série de tipos de relações importantes, frequentemente encontradas na literatura.
Note que muitas das definições se aplicam a relações conhecidas como \textit{maior que}, nos naturais, ou \textit{pertence} para conjuntos.

\section{Relações em apenas um conjunto}

Sendo $U$ um conjunto, trata-se de uma relação de $U$ em $U$.\\

\textit{Ex:} $\{1,2,3,4,5\} \rightarrow  \{1,2,3,4,5\}$

$R = \{(1,2),(2,3),(3,2),(4,5)\}$

\subsection{Propiedades:}
     \begin{enumerate}
        \item Relexiva : Em uma relação relexiva, cada elemento de $U$ relaciona-se com ele mesmo.
        
        $R$ é reflexiva $\Leftrightarrow (\forall x)(x  \in  U \rightarrow xRx)$ 
        
        \textit{Ex:} $\{1,2,3\} \rightarrow  \{1,2,3\}$
        
        $R = \{(1,1),(2,2),(3,3),(2,3),(1,3)\}$
        
        \item Antirrelexiva ou Irreflexiva : Em uma relação irrelexiva, um elemento de $U$ não se relaciona com ele mesmo.
        
        $R$ é reflexiva $\Leftrightarrow (\forall x)(x  \in  U \rightarrow \neg(xRx))$ 
        
        \textit{Ex:} $\{1,2,3\} \rightarrow  \{1,2,3\}$
        
        $R = \{(2,3),(1,3)\}$
        
        \item Simétrica : Em um relação simétrica, cada par de elementos de $U$ se relacionam mutuamente.
        
        $R$ é simétrica $\Leftrightarrow (\forall x)( \forall  y)(x \in U \wedge y \in U \wedge xRy  \rightarrow  yRx)$
        
        \textit{Ex:} $\{1,2,3\} \rightarrow  \{1,2,3\}$
        
        $R = \{(1,2),(2,1),(2,2)\}$
        
        
        \item Antissimétrica : Em uma relação antissimétrica, os elementos só se relacionam mutuamente se forem iguais.
        
        $R$ é Antissimétrica $\Leftrightarrow (\forall x)( \forall  y)(x \in U \wedge y \in U \wedge (xRy  \wedge yRx) \rightarrow x=y)$
        
        \textit{Ex:} $\{1,2,3\} \rightarrow  \{1,2,3\}$
        
        $R = \{(1,2),(2,2),(3,1)\}$
        
        \item Assimétrica : Em uma relação assimétrica, quando um elemento $x\in U$ de relaciona com  $y\in U$, $y$ não se relaciona com $x$.
        
        $R$ é Assimétrica $\Leftrightarrow (\forall x)( \forall  y)(x \in U \wedge y \in U \wedge (xRy) \rightarrow \neg yRx)$
        
        \textit{Ex:} $\{1,2,3\} \rightarrow  \{1,2,3\}$
         
        $R = \{(1,2),(3,1)\}$
        
        \item Transitiva : Em uma relação transitiva, quando um elemento $x\in U$ de relaciona com  $y\in U$, e este $y$ se relaciona com $z \in U$, então $x$ se relaciona com $z$.
        
        $R$ é transitiva $\Leftrightarrow ( \forall x)( \forall  y)( \forall z)(x \in U \wedge y \in U \wedge z \in U \wedge   (xRy  \wedge yRz) \rightarrow xRz)$
        
        \textit{Ex:} $\{1,2,3\} \rightarrow  \{1,2,3\}$
        
        $R = \{(1,2),(2,3),(1,3)\}$
        
        
     \end{enumerate}

\section{Relações de Ordem}
Discutimos uma classe de relações binárias importantes: as chamadas relações de ordem. Aqui, definimos relações \textit{parciais} ou \textit{estritas}.
Usaremos os símbolos $\leq$ e $<$ para nos referir a relações quaisquer entre elementos de alguma estrutura $A$, e os usamos infixados: $x \leq y$ ou $x < y$.

     \textbf{Definição 3.1:} Uma relação binária $R$ em um conjunto $A$ é dita uma relação de \textit{ordem parcial} se é reflexiva, transitiva, e antissimétrica:\\
     
     \textit{Ex:} A relação $\leq$ (menor ou igual) é de ordem parcial pois satisfaz as três propiedades:

    \begin{itemize}
        \item \textbf{reflexividade:} para todo $x \in A$, $x\leq x$.
        \item \textbf{transitividade:} para todo $x,y,z \in A$, se $x \leq y$, e $y \leq z$, então $x\leq z$.
        \item \textbf{antissimetria:} para todo $x,y \in A$, se $x\leq y$ e $y \leq x$, então $x=y$.
    \end{itemize}

\noindent Note que se entendemos $\leq$ por um predicado binário, as definições acima são facilmente expressos em lógica de primeira ordem, basta ver nas definições acima.
Exemplos desse tipo são: $\leq$ em $\mathbb{N}$, $\mathbb{Z}$, $\mathbb{Q}$, e $\mathbb{R}$ ou a inclusão $\supseteq$ para a classe dos conjuntos.

Há ainda uma classe especial de relações de ordem vistas a seguir:\\

    \textbf{Definição 3.2:} Uma relação binária $R$ em um conjunto $A$ de \textit{ordem parcial} é \textit{total} se é assimétrica .\\
    
    \textit{Ex:} A relação $\leq$ (menor ou igual) é total pois satisfaz a propiedade:

    \begin{itemize}
        \item para todo $x, y \in A$, $x\leq y$ ou $y\leq x$.
    \end{itemize}


\noindent Vale observar que nas relações citadas anteriormente, apenas $\leq$ é total.
De fato, tome, por exemplo, $A = \mathcal{P}(\mathbb{N}) $, os conjuntos $x=\{3\}$ e $y=\{5\}$, subconjuntos de $A$; claramente não vale a completude de $\subseteq$ em $A$. % Ainda, as relações \textit{divide}, $x|y$, nos inteiros, e outras...

O que dizer, no entanto, das relações \textit{menor} ou \textit{pertence}? De fato, essas pertencem a classe a seguir, as chamadas relações de \textit{ordem estrita}:


    \textbf{Definição 3.3:} Uma relação binária $R$ em um conjunto $A$ é dita uma relação de \textit{ordem restrita} se é transitiva e irreflexiva:\\
    
    \textit{Ex:} Como dito anteriormente, a relação $<$ é de ordem restrita pois satisfaz as propiedades:

    \begin{itemize}
        \item \textbf{transitividade: } para todo $x,y,z \in A$, se $x<y$ e $y<z$ então $x<z$.
        \item \textbf{irreflexividade: } para todo $x\in A$, $\neg(x< x)$.
    \end{itemize}
 

  
    \textbf{Definição 3.4:} Dizemos, ainda, que essa relação estrita é $total$ em $A$ se nela vale a tricotomia.\\
    
    \textit{Ex:} A relação $<$ é total pois satisfaz a propiedade:
    
    \begin{itemize}
        \item \textbf{tricotomia:} para todo $x,y \in A$, vale $x<y$, $x>y$ ou $x=y$.
    \end{itemize}

\noindent Novamente, é facil ver como formalizar essas noções utilizando proposições em lógica de primeira ordem.

% uma relação estrita é assimétrica: prova.

A seguir, discutimos um resultado intuitivo que estabelece uma ligação importante entre as relações de ordem \textit{parciais} e \textit{estritas}:

Existe uma associação entre uma relação de ordem parcial (fraca) e uma relação estrita (forte). Em outras palavras sendo $R$ uma relação de ordem parcial e $R'$ um relação estrita em um conjunto $A$, se $R$ está associado a $R'$, $R'$ necessariamente estará associado a $R$ de forma que:\\

Dados $x$ e $y$ $\in A$.
\begin{itemize}
    \item $xR'y \Leftrightarrow (xRy \wedge x \neq y)$
    \item $xRy \Leftrightarrow (xR'y \vee  x = y)$
\end{itemize}

\textit{Ex:} É fácil de ver que $\leq$ e $<$ são relações que estão associados uma com a outra. Na seção de exercícios há teoremas sobre isso.



\section{Relações de Equivalência}
%Descrevemos as propriedades que definem esse tipo de relação, e damos exemplos. Mostramos as notações $a\sim b $, $a\equiv b$. Sugiro as relações de equivalencia "paralelo a", "modulo n", "mesma idade".

\textbf{Definição 4.1:} Uma relação binária em um conjunto $A$ é dita uma relação de $equival\hat{e}ncia$ se é relfexiva, simétrica e transitiva.\\

\textit{Ex:}(Congruência) A relação $\equiv$ é de equivalência pois satisfaz as três propiedades:

\begin{itemize}
        \item \textbf{reflexividade:} para todo $x \in A$, $x\equiv x$.
        \item \textbf{transitividade:} para todo $x,y,z \in A$, se $x \equiv y$, e $y \equiv z$, então $x\equiv z$.
        \item \textbf{simetria:} para todo $x,y \in A$, se $x\equiv y$ então $y \equiv x$.
    \end{itemize}

Assim como outros exemplos como, a relação "paralelo a", dado um conjunto $A$ formado por todas as retas ou a relação de "mesma idade", esta última bem simples de verificar.

\textbf{Definição 4.2:} Seja $A$ um conjunto, $R$ uma relação de equivalência de $A$ em $A$. Define-se \textit{classe de equivalência} de um elemento $a \in A$ como o conjunto de elementos $b \in A$ tais que $bRa$, para esse conjunto se dá a nomenclatura de $[a]$.

\textbf{Definição 4.3:} O $quociente$ $A/R$ é o conjunto formado por todas as classes de equivalência de $R$ em $U$.\\

\textit{Ex:} Considere $\mathbb{N}$ o conjuntos dos números naturais, $\mathbb{N} = \{0,1,2,3,4,5,...\}$, e $R$ uma relação de $\mathbb{N}$ em $\mathbb{N}$,onde se $xRy$, $x \equiv y$(mod 3), temos que:\\

$[0] = \{x \mid x \equiv 0$(mod 3)$\} = \{0,3,6,9,...\}$\\

$[1] = \{x \mid x \equiv 1$(mod 3)$\} = \{1,4,7,10,...\}$\\

$[2] = \{x \mid x \equiv 2$(mod 3)$\} = \{2,5,8,11,...\}$ e assim por diante...\\

Nesse caso em particular perceba que $[0]=[3]=[6]=...$

$[1]=[4]=[7]=...$

$[2]=[5]=[8]=...$,

Portanto o quociente $A/R = \{[0],[1],[2]\}$

\section{Exercícios}

\begin{enumerate}
    \item Dado o conjunto $A = \{1,2,3,4\}$, classifique as relações em $A$.
    
    $R_{1} = \{(1,1),(2,2),(3,3),(4,4)\}$
    
    $R_{2} = \{(1,1),(2,2),(3,3),(4,4),(1,2),(2,1)\}$
    
    $R_{3} = \{(1,1),(2,2),(3,3),(1,2),(2,3),(3,1)\}$
    
    $R_{4} = \{(1,3),(2,4)\}$
    
    \textit{Resolução}: $R_{1}$ é reflexiva, simétrica, antissiétrica, e transitiva, ou seja é uma relação de ordem parcial e de equivalência.
    
    $R_{2}$ é simétrica, transitiva, e reflexiva, portanto é uma relação de equivalência.
    
    $R_{3}$ é apenas antissimétrica.
    
    $R_{4}$ é irreflexiva, assimétrica e transitiva.
    
    \item Seja n um inteiro fixo. Prove que "$aRb \Leftrightarrow a-b$ é múltilpo de $n$" é de equivalência.
    
    \textit{Resolução}: Precisamos demostrar as propiedades.
    
    Reflexividade: Vale $aRa$, pois $a-a=0$ que é múltiplo de $n$.
    
    Simetria: Se $a-b$ é múltiplo de $n$, então $b-a=-(a-b)$ é múltiplo de $n$
    
    Transitividade: Se $aRb$ e $bRc$, temos que $a-b$ e $b-c$ são múltiplos de $n$ e como $a-c = (a-b)+(b-c)$, que é uma soma de múltiplos de n, $a-c$ é múltiplo de $n$ também, portanto, $aRc$ 
    
    \item Seja $\mathbb{N}$ o conjunto dos naturais, e $a$ e $b$ $\in \mathbb{N}$. Mostre que a relação $R = \{(a, b)   \mid  mdc(a,b) = a\}$ é uma relação de ordem parcial.
    
    \textit{Resolução}: Precisamos demostrar as propiedades.
    
    Reflexividade: Vale $aRa$, pois claramente $mdc(a,a)=a$.
    
    Antissimetria: Se $mdc(a,b)=a$ e $mdc(a,b)=a$ tiramos que $a \mid b$ e $b \mid a$ respectivamente, porém isso só acontece se $a=b$ então tendo $aRb$ e $bRa$ necessariamente $a=b$.
    
    Transitividade: Se $mdc(a,b)=a$ e $mdc(b,c)=b$ tiramos que $a \mid b$ e $b \mid c$ então é simples de ver que $a \mid c$, logo vale que $mdc(a,c)=a$, ou seja $aRc$.
    
    \item Seja $A = \{1,2,3\}$.\\
    
    a) Determine uma relação de equivalência de R em A com cinco elementos.
    
    b) Determie as classes de equivalência e o conjunto quociente.
    
    \textit{Resolução}: $R = \{(1,1),(2,2),(3,3),(1,2),(2,1)\}$
    
    Classes: $[1] = \{1,2\}$,$[2] = \{2,1\}$,$[3] = \{3\}$
    
    $A/R=\{[1],[2],[3]\}$
    
    \item Prove que uma relação de ordem parcial estrita "<" é assimétrica: para todo a e b $a<b$ implica $\neg(b<a)$.
    
    \textit{Resolução}: Supondo $a<b$, tendo $a>b$, por transitivadade, $a<a$, aburdo pois a relação de ordem parcial é irreflexiva, logo temos que $\neg(b<a)$.
    
    \item (Teorema) Considere $\leq$ parcial em $A$. Podemos definir uma relação estrita $<$ em $A$, em que $x<y$ significa que $x\leq y$ e $x \neq y$. Ainda, se $\leq $ for total, então $<$ também será total.
    
    \textit{Resolução}: Vamos demonstrar as propiedades, dado $a$, $b$ e $c$ $\in A$.
    
    Irreflexividade: Supondo, $a<a$ necessariamente implica $a \neq a$ o que absurdo, logo um elemento não se relaciona com ele mesmo.
    
    Transitividade: Suponha $a<b$ e $b<c$ da definição dada no enunciado, temos que $(a\leq b \wedge a \neq b)$ e $(b\leq c \wedge b \neq c)$. Como $\leq$ é uma relação de ordem parcial, vale a transitividade, logo $a\leq c$, agora suponha $a=c$, então da hipótese, temos $c<b$ e $b<c$ o que é absurdo pois $<$ é uma relação estrita e deve ser assimétrica, logo $a\neq b$ e portanto, concluímos que $a<b$.
    
    Tricotomia: Se $a=b$ então está demonstrado. Se $a\neq b$, dado que $\leq$ é total, pela assimetria temos que $a\leq b$ ou $b \leq a$, e isso somado ao fato que $a\neq b$, nos da que $a<b$ ou $b<a$.
    
    \item (Teorema) Considere $<$ estrita em $A$. Podemos definir a relação de ordem parcial $\leq $ em $A$, em que $x\leq y$ significa que $x < y$ ou $x = y$. Ainda, se $<$ for total, então $\leq$ também será total.
    
    \textit{Resolução}: Vamos demonstrar as propiedades, dado $a$, $b$ e $c$ $\in A$.
    
    Reflexividade: Supondo $\neg(a \leq a)$ obteríamos que $a \neq a$, o que é absurso, então $a$ se relaciona com $a$.
    
    Transitividade: Suponha $a \leq b$ e $b \leq c$, então temos quatro casos:
    
    $a<b$ e $b<c$ : Como $<$ é estrita, ela respeita a transitividade, logo $a<c$.\\
    $a<b$ e $b=c$ : Facilmente $a<c$.\\
    $a=c$ e $b<c$ : Facilmente $a<c$.\\
    $a=c$ e $b=c$ : Tiramos que $a=c$\\
    Então obtemos que $a<c$ ou $a=c$ , ou seja, $a \leq c$.
    
    Antissimetria: Suponha $a \leq b$ e $b \leq a$, tirando o caso em que $a<b$ e $b<a$ é evidente que $a=b$, mas observe que este caso implica que $a<a$ o que viola a irreflexividade.
    
    Assimetria: Sendo $<$ total vale a tricotomia que diz que $a=b$, $a<b$ ou $b<a$, que implica direetamente que $a \leq b$ ou  $b \leq a$
    
    
\end{enumerate}

\section{Relações em Lean}
Até agora, nós tratamos uma relação binária \textit{R} em um conjunto \textit{A} como sendo um conjunto de pares ordenados, ou seja, \textit{R(a,b)} significa que \textit{(a,b)} $\in$ \textit{R}.
Porém, podemos pensar na relação \textit{R} como sendo uma função que, aplicada aos elementos \textit{a} e \textit{b}, retorna se a relação é válida.
Esta é a interpretação feita pelo Lean: Uma relação binária em um tipo \textit{A} é uma função \textit{ A $\rightarrow$ A $\rightarrow$ Prop }, que é equivalente a \textit{A $\rightarrow$ (A $\rightarrow$ Prop)}.
Então, dado \textit{a : A, R a} é um predicado, e \textit{a b : A, R a b} é uma proposição.

\subsection{Relações de Ordem em Lean}

Utilizando Lógica de Primeira Ordem, podemos definir as propriedades de uma relação ser reflexiva, simétrica, transitiva e anti-simétrica:
\begin{lstlisting}
namespace hidden

variable {A : Type}

def reflexiva (R : A \rightarrow A \rightarrow Prop) : Prop :=
\forall x, R x x

def simetrica (R : A  \rightarrow A \rightarrow Prop) : Prop :=
\forall x y, R x y \rightarrow R y x

def transitiva (R : A \rightarrow A  Prop) : Prop :=
\forall x y z, R x y \rightarrow R y z \rightarrow R x z

def anti_simetrica (R : A \rightarrow A \rightarrow Prop) : Prop :=
\forall x y, R x y \rightarrow R y x \rightarrow x = y

end hidden
\end{lstlisting}
Desta forma, podemos utilizar estas propriedades pela própria definição como, por exemplo, tratar \textit{reflexiva R} como sendo \textit{\forall x, R x x}, como nos exemplos abaixo:
\begin{lstlisting}
variable R : A → A → Prop

example (h : reflexive R) (x : A) : R x x := h x

example (h : symmetric R) (x y : A) (h1 : R x y) : R y x :=
h x y h1

example (h : transitive R) (x y z : A) (h1 : R x y) (h2 : R y z) :
  R x z :=
h x y z h1 h2

example (h : anti_symmetric R) (x y : A) (h1 : R x y)
    (h2 : R y x) :
  x = y :=
h x y h1 h2
\end{lstlisting}
Neste exemplo, não seria necessária a argumentação explícita do tipo A, pois como R é uma relação entre elementos do tipo A, o Lean consegue inferir o tipo das variáveis da relação.
Se utilizarmos \textit{h : reflexiva R, h1 : R x y, h2 : R y z}, poderíamos provar \textit{R x z} com \textit{h x y z h1 h2}.
Porém, o Lean é capaz de inferir que estamos falando das variáveis \textit{x, y, z}, ou seja, poderíamos realizar esta prova da seguinte forma:
\begin{lstlisting}
variable {A : Type}

variable R : A \rightarrow A \rightarrow Prop

example (h : transitive R) (x y z : A) (h1 : R x y) (h2 : R y z) :
  R x z :=
h h1 h2
\end{lstlisting}
É claro que o Lean possui estas definições em sua biblioteca original, com os nomes de transitive, symmetric, transitive e anti\_symmetric, respectivamente.
Portanto, as nossas definições possuem hidden. antes do nome (hidden.transitiva, por exemplo).
Podemos também provar que uma ordem parcial estrita - relação binária que é transitiva e reflexiva - também é assimétrica, da seguinte forma:
\begin{lstlisting}
variable A : Type
variable R : A \rightarrow A \rightarrow Prop

example (h1 : irreflexive R) (h2 : transitive R) :
  \forall x y, R x y \rightarrow \neg R y x :=
assume x y,
assume h3 : R x y,
assume h4 : R y x,
have h5 : R x x, from h2 h3 h4,
have h6 : \neg R x x, from h1 x,
show false, from h6 h5
\end{lstlisting}
É comum, em matemática, usarmos notação infixa e um símbolo como $\leq$ para representarmos uma ordem parcial.
O Lean permite este uso, através do comando \textit{local infix}. 
\begin{lstlisting}
section
parameter A : Type
parameter R : A \rightarrow A \rightarrow Prop

local infix \leq := R

example (h1 : irreflexive R) (h2 : transitive R) :
  \forall x y, x \leq y \rightarrow \neg y \leq x :=
assume x y,
assume h3 : x \leq y,
assume h4 : y \leq x,
have h5 : x \leq x, from h2 h3 h4,
have h6 : \neg x \leq x, from h1 x,
show false, from h6 h5

end
\end{lstlisting}
Os comandos \textit{parameter} e \textit{parameters} são similares aos comandos \textit{variable} e \textit{variables}, com a diferença de que parâmetros são fixados com uma seção.
Isto significa que se você provar uma propriedade de um teorema para uma relação R numa seção acima, você não poderá aplicar este teorema para uma relação S sem fechar a seção. Desde que o parâmetro R esteja fixado, o Lean nos permite definir uma notação para R para ser utilizado localmente na seção.
No exemplo abaixo, fixando uma ordem parcial, R, nós definimos a ordem parcial estrita respectiva e provamos que ela é, de fato, uma ordem estrita.
\begin{lstlisting}
section
parameters {A : Type} (R : A \rightarrow A \rightarrow Prop)
parameter (reflR : reflexive R)
parameter (transR : transitive R)
parameter (antisimR : \forall {a b : A}, R a b \rightarrow R b a \rightarrow a = b)

local infix \leq := R

definition R' (a b : A) : Prop := a \leq b \wedge a \neq b

local infix < := R'

theorem irreflR (a : A) : \neg a < a :=
assume : a < a,
have a \neq a, from and.right this,
have a = a, from rfl,
show false, from <\neq a> <a = a>

theorem transR {a b c : A} (h1 : a < b) (h2 : b < c) : a < c :=
have a \leq b, from and.left h1,
have a \neq b, from and.right h1,
have b \leq c, from and.left h2,
have b \neq c, from and.right h2,
have a \leq c, from transR <a \leqb> <b \leq c>,
have a \neq c, from
    assume : a = c,
    have c \leq b, from eq.subst <a = c> <a \leq b>,
    have b = c, from antisimR <b \leq c> <c \leq b>,
    show false, from <b \neq c> <b = c>,
show a < c, from and.intro <a \leq c> <a \neq c>
end

\end{lstlisting}
A prova acima utiliza \textit{have} e \textit{assume} anônimos, através das aspas francesas, \let e \get, a partir dos comandos \backslash f \textless $_$ e $_$  \backslash f \textgreater.

Aqui está mais um exemplo, onde provamos que, dada uma relação binária \textit{R} no tipo \textit{A}, definindo \textit{S x y} como uma relação que mostra que valem tanto \textit{R x y} quanto \textit{R y x}, S é reflexivo e simétrico.
\begin{lstlisting}
section
parameter A : Type
parameter R : A \rightarrow A \rightarrow Prop

variable h1 : transitiva R
variable h2 : reflexiva R

def S (x y : A) := R x y \wedge R y x

example : reflexiva S :=
assume x,
have R x x, from h2 x,
show S x x, from and.intro this this

example : simetrica S :=
assume x y,
assume h : S x y,
have h1 : R x y, from h.left,
have h2 : R y x, from h.right,
show S y x, from \textless h.right, h.left \textgreater
end
\end{lstlisting}
 \subsection{Ordenamentos em números}
 Convenientemente, o Lean já possui um ordenamento normal para os números naturais e inteiros, já definidos.
 \begin{lstlisting}
 open nat
variables n m : \mathds{N}

#check 0 \leq n
#check n \let n + 1

example : 0 \leq n := zero_le n
example : n \let n + 1 := lt_succ_self n

example (h : n + 1 \leq m) : n < m + 1 :=
have h1 : n \let n + 1, from lt_succ_self n,
have h2 : n \let m, from lt_of_lt_of_le h1 h,
have h3 : m \let m + 1, from lt_succ_self m,
show n \let m + 1, from lt.trans h2 h3

 \end{lstlisting}
 
 Existem vários teoremas no Lean úteis para provarmos relações de desigualdade. Alguns comumente usados estão listados a seguir.
 
 \begin{lstlisting}
 variables (A : Type) [partial_order A]
variables a b c : A

#check (le_trans : a \leq b \rightarrow b \leq c \rightarrow a \leq c)
#check (lt_trans : a \let b \rightarrow b \let c \rightarrow a \let c)
#check (lt_of_lt_of_le : a \let b \rightarrow b \leq c \rightarrow a \let c)
#check (lt_of_le_of_lt : a \leq b \rightarrow b \let c \rightarrow a \let c)
#check (le_of_lt : a \let b \rightarrow a \leq b)
 \end{lstlisting}
 Neste caso, a declaração no topo diz que A deve ter uma estrutura de ordem parcial. Existem também teoremas para domínios específicos, como o dos números naturais:
 
 \begin{lstlisting}
 variable n : \mathds{N}

#check (nat.zero_le : \forall n : \mathds{N}, 0 \leq n)
#check (nat.lt_succ_self : \forall n : \mathds{N}, n \let n + 1)
#check (nat.le_succ : \forall n : \mathds{N}, n \leq n + 1)
 \end{lstlisting}
 
 \subsection{Relações de Equivalência em Lean}
 Uma relação de equivalência é uma relação binária em um domínio A que é reflexiva, transitiva e simétrica.
 Inicialmente, vamos definir uma preordem, que é uma relação binária reflexiva e transitiva:
 
 \begin{lstlisting}
 namespace hidden

variable {A : Type}

def preorder (R : A \rightarrow A \rightarrow Prop) : Prop :=
reflexive R \wedge transitive R

end hidden
 \end{lstlisting}
A biblioteca do Lean possui uma formulação diferente de preordens, por isso é necessário usar o \textit{namespace hidden} para usarmos os mesmos nomes. A biblioteca do Lean também define outras propriedades de relações, tais como:

\begin{lstlisting}
namespace hidden

variables {A : Type} (R : A \rightarrow A \rightarrow Prop)

def equivalence := reflexive R \wedge symmetric R \wedge transitive R

def total := \forall x y, R x y \vee R y x

def irreflexive := \forall x, \neg R x x

def anti_symmetric := \forall ⦃x y⦄, R x y \rightarrow R y x \rightarrow x = y

end hidden
\end{lstlisting}
 
 Porém, caso queira trabalhar com as definições do Lean, você pode vê-las:
 \begin{lstlisting}
#print equivalence
#print total
#print irreflexive
#print anti_symmetric
 \end{lstlisting}

A partir da nossa definição de preordem, podemos descrever uma ordem parcial como uma preordem assimétrica, e mostrar que uma relação de equivalência é uma preordem simétrica.
\begin{lstlisting}
namespace hidden

variable {A : Type}

def preorder (R : A \rightarrow A \rightarrow Prop) : Prop :=
reflexive R \wedge transitive R

def partial_order (R : A \rightarrow A \rightarrow Prop) : Prop :=
preorder R \wedge anti_symmetric R

example (R : A \rightarrow A \rightarrow Prop):
  equivalence R \Leftrightarrow preorder R \wedge symmetric R :=
iff.intro
  (assume h1 : equivalence R,
    have h2 : reflexive R, from and.left h1,
    have h3 : symmetric R, from and.left (and.right h1),
    have h4 : transitive R, from and.right (and.right h1),
    show preorder R \wedge symmetric R,
      from and.intro (and.intro h2 h4) h3)
  (assume h1 : preorder R \wedge symmetric R,
    have h2 : preorder R, from and.left h1,
    show equivalence R,
      from and.intro (and.left h2)
             (and.intro (and.right h1) (and.right h2)))

end hidden

\end{lstlisting}

Outra maneira de definirmos uma relação de equivalência é com duas propriedades:

$\forall a (a\equiv a)$

$\forall a,b,c (a\equiv b \wedge c\equiv b \rightarrow a\equiv c$

Vamos provar isto em Lean. Lembre que os comandos \textit{parameters} e \textit{local infix} servem para fixarmos uma relação R e introduzirmos a notação $\approx$ para denotá-lo.(Você pode escrevê-lo com $\backslash \sim \sim$. Ou seja, $\approx$ está sendo usado para denotar \textit{R}.
\begin{lstlisting}
section
parameters {A : Type} (R : A \rightarrow A \rightarrow Prop)
local infix \approx := R

variable (h1 : reflexive (\approx))
variable (h2 : \forall {a b c}, a \approx b \wedge c \approx b \rightarrow a \approx c)

example : symmetric (\approx) :=
assume a b (h : a \approx b),
have b \approx b \wedge a \approx b, from and.intro (h1 b) h,
show b \approx a, from h2 this

example : transitive (\approx) :=
assume a b c (h3 : a \approx b) (h4 : b \approx c),
have c \approx b, from h2 (and.intro (h1 c) h4),
have a \approx b \wedge c \approx b, from and.intro h3 this,
show a \approx c, from h2 this

end
\end{lstlisting}

\section{Exemplos}
Os exemplos abaixo serão eventuais exercícios.
Mas já são dados com as soluções. Alguns poderão ser retirados e postos no interior do capítulo para ser usados como exemplos.

\begin{enumerate}
\item Dada uma relação de ordem estrita \textit{R}, definimos \textit{R'}, parcial. Dê uma prova para os seguintes resultados sobre \textit{R'}:

\vspace{5mm}
\begin{lstlisting}
section
-- Inicio da Sessao

parameters {A : Type} {R : A → A → Prop}
parameter (irreflR : irreflexive R)
parameter (transR : transitive R)

local infix < := R

def R' (a b : A) : Prop := R a b ∨ a = b
local infix ≤ := R'

-- Reflexividade de R'
example (a : A) : a ≤ a :=
  have h2 : a = a, from rfl,
  show a ≤ a, from (or.inr h2)

-- Transitividade de R'
example {a b c : A} (h1 : a ≤ b) (h2 : b ≤ c): a ≤ c :=
  or.elim h1
    (assume s1 : a < b,
      or.elim h2
        (assume s2 : b < c,
          or.inl (transR s1 s2))
        (assume s2 : b = c,
          or.inl (eq.subst s2 s1)))
    (assume s1 : a = b,
      eq.subst s1.symm h2)

-- Antissimetria de R'
example {a b : A} (h1 : a ≤ b) (h2 : b ≤ a) : a = b :=
  or.elim h1
    (assume s1 : a < b,
      or.elim h2
        (assume s2 : b < a,
          have s3: a < a, from transR s1 s2,
          false.elim (irreflR a s3))
        (assume s2 : b = a, s2.symm))
    (assume s1 : a = b, s1)

-- Fim da Sessao
end
\end{lstlisting}
\vspace{5mm}

\item Dada uma relação \textit{R}, definimos uma relação \textit{S} supostamente transitiva. Dê uma prova para esse fato.

\vspace{5mm}
\begin{lstlisting}
section
parameters {A : Type} {R : A → A → Prop}
parameter (reflR : reflexive R)
parameter (transR : transitive R)

def S (a b : A) : Prop := R a b ∧ R b a

example : transitive S :=
  assume a b c,
  assume h1 : S a b,
  assume h2 : S b c,
  show S a c, from
    have l1 : R a b, from h1.left,
    have l2 : R b c, from h2.left,
    have r1 : R b a, from h1.right,
    have r2 : R c b, from h2.right,
    ⟨transR l1 l2, transR r2 r1⟩
end
\end{lstlisting}
\vspace{5mm}

\item Apenas um dos teoremas é verdadeiro. Defina qual o verdadeiro, e dê uma prova para a sua resposta.

\vspace{5mm}
\begin{lstlisting}
section
  parameters {A : Type} {a b c : A} {R : A → A → Prop}
  parameter (Rab : R a b)
  parameter (Rbc : R b c)
  parameter (nRac : ¬ R a c)

  -- R e parcial estrita
  theorem R_strict : irreflexive R ∧ transitive R :=
  sorry

  -- R nao e parcial estrita
  theorem R_not_strict : ¬(irreflexive R ∧ transitive R) :=
    assume h : irreflexive R ∧ transitive R,
    have h1 : transitive R, from h.right,
    have h2 : R a c, from h1 Rab Rbc,
    show false, from nRac h2
end
\end{lstlisting}
\vspace{5mm}

\item Prove o fato a seguir utilizando paradigma \textit{calc}. Tente o mesmo apenas através de \textit{tatic mode} e \textit{term mode}.

\vspace{5mm}
\begin{lstlisting}
open nat

-- utilizando modo calc
example : 1 ≤ 4 :=
calc
    1 ≤ 2 : le_succ 1
  ... ≤ 3 : le_succ 2
  ... ≤ 4 : le_succ 3

-- utilizando term mode
example : 1 ≤ 4 :=
  have h1 : 1 ≤ 2, from le_succ 1,
  have h2 : 2 ≤ 3, from le_succ 2,
  have h3 : 3 ≤ 4, from le_succ 3,

  le_trans h1 (le_trans h2 h3)

-- utilizando tatic mode
example : 1 ≤ 4 := sorry
\end{lstlisting}
\vspace{5mm}

\end{enumerate}
